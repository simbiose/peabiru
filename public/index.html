<!DOCTYPE html>
<html>

  <head>
    <title>Peabiru</title>

    <link rel='stylesheet' href='/styles/main.css' />
    <link rel='stylesheet' href='//unpkg.com/leaflet@1.0.1/dist/leaflet.css' />

    <script src='//unpkg.com/leaflet@1.0.1/dist/leaflet.js' type='text/javascript'></script>
  </head>

  <body>

    <header>
      <h1>Peabiru</h1>
      <h2>Help connecting places now!</h2>
      <div class='login-btns'>
        <a href='#login/osm'      class='icon-osm-circled'      title='Open Street Map'></a>
        <a href='#login/facebook' class='icon-facebook-circled' title='Facebook'></a>
        <a href='#login/github'   class='icon-github-circled'   title='Github'></a>
        <a href='#login/twitter'  class='icon-twitter-circled'  title='Twitter'></a>
        <a href='#login/google'   class='icon-gplus-circled'    title='Google'></a>
      </div>
    </header>

    <footer>
      made with <span class='heart' title='love'></span> by
      <a href='https://www.openstreetmap.org/user/xxleite'>@xxleite</a>&nbsp;&nbsp;|&nbsp;
      source at <a href='https://github.com/simbiose/peabiru'>github</a>
      <br />
      &copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors,
      &copy; <a href='http://cartodb.com/attributions'>CartoDB</a>
    </footer>

    <div id='bg-map'></div>

    <script type='text/javascript' >
      (function () {
        var path = [
          [-23.88884, -46.78596], [-23.83986, -46.72554], [-23.79463, -46.76537],
          [-23.69155, -46.82991], [-23.52293, -46.82854], [-23.47634, -46.90407],
          [-23.2696,  -46.84227], [-23.11433, -46.92055], [-22.99429, -47.06886],
          [-23.03094, -47.1801],  [-23.24436, -47.31194], [-23.40704, -47.37373],
          [-23.50782, -47.53304], [-23.36418, -47.85713], [-23.23553, -47.97386],
          [-23.05369, -47.9821],  [-22.95383, -48.19771], [-22.88426, -48.48473],
          [-22.69815, -48.43803], [-22.55618, -48.12904], [-22.54857, -47.76924],
          [-22.37978, -47.57698], [-22.00977, -47.90382], [-21.75107, -48.2032],
          [-21.26556, -48.41194], [-20.5613,  -48.54515], [-20.66027, -48.98735],
          [-20.86958, -49.3705],  [-20.37088, -49.96239], [-20.22018, -50.52818],
          [-20.65513, -51.05553], [-20.39276, -51.43593]
        ];

        var speed   = 2000 * 0.277778, // km/h -> m/s ~ 20 times naoliv's traffic ticket
          index     = 0,
          duration  = 0,
          direction = 1,
          map       = L.map('bg-map', {
            reuseTiles:true, unloadInvisibleTiles:true, zoomControl:false,
            dragging:false, touchZoom:false, doubleClickZoom:false, scrollWheelZoom:false
          }).setView(path[index], 13);

        function travel () {
          direction = index > path.length -2 ? -1 : (index < 1 ? 1 : direction);
          duration  = Math.ceil(map.getCenter().distanceTo(path[index += direction * 1]) / speed);
          console.log(
            ' going to ('+ path[index].join(', ') +'), duration '+ duration +'s at '+ speed +'m/s'
          );
          map.panTo(path[index], {animate:true, duration:duration, easeLinearity:1.0});
          setTimeout(travel, duration * 1000);
        };

        setTimeout(travel, duration);

        L.tileLayer(
          'http://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}.png',
          {attribution: '&nbsp;', maxZoom: 13}
        ).addTo(map);

      })();
    </script>
  </body>

</html>
